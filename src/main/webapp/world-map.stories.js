import { storiesOf } from './@storybook/react'
import { withKnobs, select } from '@connexta/ace/@storybook/addon-knobs'
import React from 'react'
import WorldMap from './world-map'
import { geometry, coordinates } from 'geospatialdraw'
import { Style, Fill, Circle, Stroke } from 'ol/style'
const { BUFFER_CLASSNAME, HIDDEN_CLASSNAME, POINT_RADIUS } = geometry

const featureHasClass = (feature, className) =>
  (feature.get('class') || []).includes(className)

const featureColor = feature =>
  featureHasClass(feature, HIDDEN_CLASSNAME)
    ? 'rgba(0, 0, 0, 0)'
    : feature.get('color') || 'blue'

const LINE_WIDTH = 1.8
const POINT_SIZE = 4

const MAP_STYLE = feature =>
  new Style({
    stroke: new Stroke({
      color: featureColor(feature),
      width: LINE_WIDTH,
    }),
    fill: new Fill({
      color: 'rgba(0, 0, 0, 0)',
    }),
    ...(featureHasClass(feature, BUFFER_CLASSNAME) &&
    feature.get('shape') === POINT_RADIUS
      ? {}
      : {
          image: new Circle({
            radius: POINT_SIZE,
            fill: new Fill({
              color: featureColor(feature),
            }),
          }),
        }),
  })

const PROJECTION = 'EPSG:4326'

const stories = storiesOf('WorldMap', module)
stories.addDecorator(withKnobs)

stories.add('bare map', () => {
  return (
    <WorldMap
      projection={PROJECTION}
      style={MAP_STYLE}
      coordinateType="LAT LON"
      maxZoom={20}
      minZoom={1.5}
      zoom={2}
      height="500px"
    />
  )
})

stories.add('render geometries', () => {
  const geos = [
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [-77.14101030066769, 38.12853403337011],
            [-77.15732422141605, 38.090304558346936],
            [-77.17227678899663, 38.059283559933505],
            [-77.2787301432643, 38.042947321920096],
            [-77.39377564457455, 38.10478846336155],
            [-77.37989430571616, 38.211621211135004],
            [-77.29066988006372, 38.23704057602198],
            [-77.23655051232805, 38.17776592006078],
            [-77.14101030066769, 38.12853403337011],
          ],
        ],
      },
      properties: {
        shape: 'Polygon',
        id: 'shape1',
        color: '#a020f0',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        -77.39377564457455,
        38.042947321920096,
        -77.14101030066769,
        38.23704057602198,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [-48.52260964518281, -5.422812136709466],
            [-48.20103414906473, -5.921405130103808],
            [-48.58495335774491, -6.656576615699192],
            [-49.35629496058171, -7.220492195843082],
            [-49.05070514670665, -8.114299347133246],
            [-50.494650503939695, -10.315617580582623],
            [-50.555500573327464, -12.51119524144825],
            [-49.699389848670606, -12.992255223966657],
            [-48.84844563933912, -12.873616723902453],
            [-47.881541863815855, -13.518283025057785],
            [-46.95692697299289, -13.140361996627453],
            [-46.08493399752098, -13.000483378003368],
            [-46.11803796608728, -11.901355080634344],
            [-46.530019725181205, -11.17708617298432],
            [-45.75886947476387, -10.136511715969567],
            [-46.50648337758783, -9.950325811836548],
            [-46.81628294469097, -9.007723793584494],
            [-46.55585230180809, -8.050578991453602],
            [-47.15650754648799, -7.875682880068629],
            [-47.495392681348804, -6.901699065025397],
            [-47.4075619208174, -5.461580756181515],
            [-48.101023088934625, -4.881208867964203],
            [-48.52260964518281, -5.422812136709466],
          ],
        ],
      },
      properties: {
        shape: 'Polygon',
        id: 'shape2',
        color: '#ffd700',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        -50.555500573327464,
        -13.518283025057785,
        -45.75886947476387,
        -4.881208867964203,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [129.1518048627637, -31.629617510480546],
            [129.05907305960878, -25.93903105437493],
            [141.08274489367915, -26.010442822429503],
            [140.87057949583584, -37.992509539459405],
            [140.09850443831823, -37.76171498473229],
            [139.64540194477775, -36.77768152000342],
            [139.03146773014043, -35.660346088239336],
            [138.06150962839044, -35.888242774117856],
            [136.83571110543622, -35.99091012761082],
            [135.63019766442213, -34.850391745058005],
            [134.23673672951367, -33.08745253195413],
            [133.78342724534116, -32.1932530015316],
            [131.96563551474608, -32.05125742795062],
            [131.32334358351898, -31.491968740172446],
            [129.1518048627637, -31.629617510480546],
          ],
        ],
      },
      properties: {
        shape: 'Polygon',
        id: 'shape3',
        color: '#ff00ff',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        129.05907305960878,
        -37.992509539459405,
        141.08274489367915,
        -25.93903105437493,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [112.66897771954346, 47.8014155606246],
            [112.76517881053884, 47.60824961436289],
            [113.66977457160384, 47.533633165806926],
            [114.45758081350047, 47.14843031611881],
            [114.42756155693857, 46.84807171478872],
            [114.65177618117082, 46.72985428850513],
            [114.9275947044044, 46.48847157174798],
            [115.43516587315291, 46.55445416332818],
            [115.74273042434355, 46.56478158455688],
            [116.30303453492868, 46.597723069633666],
            [116.51034672377376, 46.30828961809215],
            [116.51014748092048, 46.17283768499923],
            [116.2526593001893, 45.91422046143276],
            [116.28599927097265, 45.758611793015646],
            [116.03309367586708, 45.6576952878258],
            [115.68747373969863, 45.433181799313616],
            [114.92629962585804, 45.36351321494761],
            [114.77255055740493, 45.42086194955204],
            [114.553184175936, 45.38523068595589],
            [114.35722882972827, 45.08782752028289],
            [114.14523443383095, 44.975554172455695],
            [113.92377600240249, 44.927071744822534],
            [113.66575650739588, 44.75728362667983],
            [113.46448801843384, 44.78683798325073],
            [112.9438000285106, 44.79567108307978],
            [112.55275272179273, 44.937266337482384],
            [112.44519478816, 45.072917513428585],
            [112.0887161164874, 45.06640891355455],
            [111.97777105434879, 45.069065484931706],
            [111.930118805271, 45.21474521782668],
            [111.71636443083631, 45.50358094080834],
            [111.69557675981004, 45.75031000746202],
            [111.64825658215437, 46.060066230038814],
            [111.19816697657915, 46.24124439796108],
            [111.24761241133652, 46.382275130946034],
            [111.24382679712407, 46.60406563379663],
            [111.36679284474434, 46.74748728102102],
            [111.49583579938985, 47.187548329647484],
            [111.7724845011788, 47.38174369731784],
            [112.05667122425042, 47.34999766936078],
            [112.0966858306189, 47.64872912072236],
            [112.377850703749, 47.7484833759347],
            [112.66897771954346, 47.8014155606246],
          ],
        ],
      },
      properties: {
        shape: 'Polygon',
        id: 'shape4',
        color: '#ffff00',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        111.19816697657915,
        44.75728362667983,
        116.51034672377376,
        47.8014155606246,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [2.3801982067247183, 10.380487991234242],
      },
      properties: {
        shape: 'Point Radius',
        id: 'shape5',
        color: '#a52a2a',
        buffer: 86.22498402406272,
        bufferUnit: 'kilometers',
      },
      bbox: [
        1.591858105761676,
        9.605049151287616,
        3.1685383076877605,
        11.155926831180869,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [-77.03353449715513, 38.88832624652902],
      },
      properties: {
        id: 'shape6',
        color: '#0000ff',
        shape: 'Point',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        -77.03353449715513,
        38.88832624652902,
        -77.03353449715513,
        38.88832624652902,
      ],
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [37.631401597084825, 55.74584388706087],
      },
      properties: {
        shape: 'Point',
        id: 'shape7',
        color: '#ff0000',
        buffer: 0,
        bufferUnit: 'meters',
      },
      bbox: [
        37.631401597084825,
        55.74584388706087,
        37.631401597084825,
        55.74584388706087,
      ],
    },
  ]
  const shapeIndex = select(
    'Pan To',
    ['none', '1', '2', '3', '4', '5', '6', '7'],
    'none'
  )
  const viewport = shapeIndex === 'none' ? null : geos[shapeIndex - 1].bbox
  return (
    <WorldMap
      projection={PROJECTION}
      style={MAP_STYLE}
      geos={geos}
      viewport={viewport}
      coordinateType={coordinates.LAT_LON}
      maxZoom={20}
      minZoom={1.5}
      zoom={2}
      height="500px"
    />
  )
})
